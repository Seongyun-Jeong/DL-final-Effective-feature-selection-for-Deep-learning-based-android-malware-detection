import csv

features = open('dataset-features-categories.csv', 'r')
datas = open('drebin-215-dataset-5560malware-9476-benign.csv', 'r')
permission = open('permission-dataset.csv', 'w')
permission_dataset = csv.writer(permission)
api = open('api-dataset.csv', 'w')
api_dataset = csv.writer(api)

feature_map = set()
feature_name = []
other_map = set()
other_name = []

cnt = 0
for line in features:
    line_info = line.split(',')
    line_info1 = line_info[1].strip('\n')
    line_info2 = line_info[0]
    if(line_info1 == "Manifest Permission"):
        feature_map.add(cnt)
        feature_name.append(line_info2)
    else:
        print(cnt)
        other_map.add(cnt)
        other_name.append(line_info2)
    cnt += 1
print(cnt)
feature_map.add(cnt-1)
feature_name.append("class")

print(feature_name)
print(other_name)

permission_dataset.writerow(feature_name)
api_dataset.writerow(other_name)
first = True
for line in datas:
    if(first):
        first = False
        continue
    info = line.split(',')
    permission_list = []
    api_list = []
    cnt = 0
    # for i in info:
    for i in info:
        if(cnt == len(info)-1):
            if(i.strip('\n') == "B"):
                api_list.append(1)
                permission_list.append(1)
            else:
                api_list.append(0)
                permission_list.append(0)
        elif(cnt in feature_map):
            permission_list.append(i)
        elif(cnt in other_map):
            api_list.append(i)
        else:
            print("error")
            ValueError
        cnt += 1
    permission_dataset.writerow(permission_list)
    api_dataset.writerow(api_list)
